<!-- Application -->
<app>

    <div id="tabs-selector"></div>
    <div id="tabs"></div>

    <script>
        let self = this;

        /* global RiotControl ACTION */
        let rc = RiotControl;

        self.remote = require("electron").remote;

        let menuTemplate = [
            {
                label: "ファイル",
                submenu: [
                    {
                        label: "Open",
                        accelerator: "Command+O",
                        click: function(){rc.trigger(ACTION.DIALOG_FILE_OPEN);}
                    },
                    {
                        label: "Quit",
                        accelerator: "Command+Q",
                        click: function() { app.quit(); }
                    },
                ]
            },
            {
                label: "操作",
                submenu: [
                    {
                        label:"Next Tab",
                        accelerator:"Command+N",
                        click: function () {m_window.webContents
                        .send("main.js", {request:"NextTab", dir:true});;}
                    },
                    {
                        label:"Previous Tab",
                        accelerator:"Command+P",
                        click: function () {m_window.webContents
                        .send("main.js", {request:"NextTab", dir:false});;}
                    },
                    {
                        label:"Zoom up",
                        accelerator:"Command+Shift+=",
                        click: function(){Zoom(true);}
                    },
                    {
                        label:"Zoom down",
                        accelerator:"Command+-",
                        click: function(){Zoom(false);}
                    },
                ]
            },
            {
                label: "表示",
                submenu: [
                    {
                        label:"全体を半透明化",
                        accelerator:"Command+Shift+O",
                        click: function(){Transparent(true, false);}
                    },
                    {
                        label:"背景を透明化",
                        //accelerator:"Command+P",
                        click: function(){Transparent(true, true);}
                    },
                    {
                        label:"透明化を解除",
                        //accelerator:"Command+Shift+=",
                        click: function(){Transparent(false, false);}
                    },
                    {
                        label:"全体を橙色に",
                        //accelerator:"Command+-",
                        click: function(){Color("#f80");}
                    },
                    {
                        label:"全体を青色に",
                        //accelerator:"Command+-",
                        click: function(){Color("#08f");}
                    },
                    {
                        label:"デフォルトの配色",
                        //accelerator:"Command+-",
                        click: function(){Color(null);}
                    },
                    {
                        label:"Retina切り替え",
                        //accelerator:"Command+-",
                        click: function () {m_window.webContents
                        .send("main.js", {request:"Retina"});;}
                    },
                ]
            }
        ];

        // 読み込みダイアログ
        rc.on(ACTION.DIALOG_FILE_OPEN, function(){
            const dialog = self.remote.dialog;
            dialog.showOpenDialog(
                null, {
                    properties: ["openFile"],
                    filters: [
                        {
                            name: "Konata log",
                            extensions: ["txt", "text", "log", "gz"]
                        }
                    ],
                    defaultPath: "."
                },
                function(fileNames){
                    if (!fileNames) {
                        return;
                    }

                    // 事実上のオープン
                    /* Send */
                    Send(fileNames[0]);
                }
            );
        });


        // 初期化
        // マウント時に呼ばれる
        self.init = function(){
            // メニューを追加
            let Menu = self.remote.Menu;
            let menu = Menu.buildFromTemplate(menuTemplate);
            Menu.setApplicationMenu(menu);

        };

        // エントリポイント
        self.on("mount", self.init);

    </script>
</app>


